
%自动化1201班   李胜
%http://lvcha6255.blog.sohu.com/
%国歌部分
fs = 48000; %频率
dt = 1/fs; %播放速度
f0 = 320;
T16 = 0.125;
t16 = 0:dt:T16;
m = size(t16,2);
t2 = linspace(0,8*T16,8*m);
t4 = linspace(0,4*T16,4*m);
t8 = linspace(0,2*T16,2*m);
t12 = linspace(0,4/3*T16,4/3*m);%定义音阶强度
index = {'2';'4';'8';'12';'16'};%  音符   二分音符 四分音符 八分音符 十二分音符 十六分音符
for n = 1:5
    str = ['mod',char(index(n)),' = sin(pi*t',char(index(n)),...
        '/t',char(index(n)),'(end));'];
    eval(str);
end
ScaleTable = [1/2 9/16 5/8 2/3 3/4 5/6 15/16 ...
    1 9/8 5/4 4/3 3/2 5/3 9/5 15/8 ...
    2 9/4 5/2 8/3 3 10/3 15/4 4];
txt = {'do','re','mi','fa','so','la','si'};%音符数组
nstr = {'0','1','2'};%强度字符串，0为低音，1为正常音，2为高音
mstr = {'g','f','e','d','s'}; %音符字符串 g  f  e  d  s
for nn = 1:5
    for jj = 1:3
        for ii = 1:7
            mm = 7*(jj - 1) + ii;
            str = [char(txt(ii)),char(nstr(jj)),char(mstr{nn}),...
                ' = mod',char(index(nn)),...
                '.*cos(2*pi*ScaleTable(',num2str(mm),')*f0*t',...
                char(index(nn)),');'];
            eval(str);
        end
    end
end                          %各分音符的数组

g = zeros(1,size(t2,2));%字符g，二分音符
f = zeros(1,size(t4,2));%字符f，四分音符
e = zeros(1,size(t8,2));%字符e，八分音符
d = zeros(1,size(t12,2));%字符d，十二分音符
s = zeros(1,size(t16,2));%字符s，十六分音符

yuepu = [do1e s mi1s so1e so1e,...
    la1f so1f,...
    mi1e s do1s so1d so1d so1d ,...
    mi1f do1f ,...
    so0d so0d so0d so0d so0d so0d,...
    do1f e so0e,...
    do1f e do1e,...
    do1e s do1s so0e la0s si0s,...
    do1f do1f,...
    e mi1e do1e re1s mi1s,...
    so1f so1f,...
    mi1e s mi1s do1e s mi1s,...
    so1e s mi1s re1f,...
    re1g,...
    la1f so1f,...
    re1f mi1f,...
    so1e mi1e e so1e,...
    mi1e re1s mi1s do1f,...
    mi1f f,...
    so0e s la0s do1e do1e,...
    mi1e s mi1s so1e so1e,...
    re1e re1s re1s la0f,...
    re1f e so0e,...
    do1f e do1e,...
    mi1f e mi1e,...
    so1g,...
    do1e s mi1s so1e so1e,...
    la1f so1f,...
    mi1e s do1s so1d so1d so1d,...
    mi1e e do1e e,...
    so0f do1f,...
    mi1e s do1s so1d so1d so1d,...
    mi1e e do1e e,...
    so0f do1f s,...
    so0f do1f s,...
    so0f do1f s,...
    do1f e e];%国歌乐谱（yuepu数组内变量的命名规则：“音阶+强度+音符”形式）

s = yuepu;
s = s/max(s);
%
%升国旗部分
axis([0,50,0,50]);%设定坐标，横坐标范围0到50，纵坐标范围0到50
hold on;%保持当前图形及轴系的所有特性
axis off;%关闭坐标
set(gcf,'doublebuffer','on') %消除抖动
r1=1;%设置旗柱两端椭圆的长半径长度
r2=0.5;%设置旗柱两端椭圆的短半径长度
a=0:0.01:2*pi;%绘制椭圆，0到2pi,椭圆的变化速率是0.1
fill(25+r1*cos(a),48+r2*sin(a),'k');
fill(25+r1*cos(a),r2*sin(a),'k');%画椭圆
line([24.5,24.5],[0,48],'color','k','linewidth',2);%构成旗杆的第一条线，横坐标24.5，纵坐标为0到48，颜色为黑色
line([24,24],[0,48],'color','k','linewidth',2);%构成旗杆的第二条线，横坐标为24，纵坐标为0到48，黑色
line([26,26],[0,48],'color','k','linewidth',2);%构成旗杆的第三条线，横坐标为26，纵坐标为0到48，黑色
line([25.5,25.5],[0,48],'color','k','linewidth',2);%构成旗杆的第四条线，横坐标为25.5，纵坐标为0到48，黑色
flag=rectangle('Position',[25.5,0,10,8],'FaceColor','red');
a1=line(28,5,'color','y','linestyle','p','markersize',16,'MarkerFaceColor','y');
a2=line(29,3,'color','y','linestyle','p','markersize',8,'MarkerFaceColor','y');
a3=line(30,4,'color','y','linestyle','p','markersize',8,'MarkerFaceColor','y');
a4=line(30,5.5,'color','y','linestyle','p','markersize',8,'MarkerFaceColor','y');
a5=line(29,7,'color','y','linestyle','p','markersize',8,'MarkerFaceColor','y');%五角星
dt=0.0168;%设置旗子的速度
my1=0;%旗子下边沿的初始高度
my2=5;
my3=3;
my4=4;
my5=5.5;
my6=7;%设定旗子五角星的初始高度
sound(s,fs);%调用函数播放
while my1<=39.5 %用循环来移动旗子
my1=my1+dt;%旗子上边沿的运动函数
my2=my2+dt;%五角星的运动函数
my3=my3+dt;
my4=my4+dt;
my5=my5+dt;
my6=my6+dt;
set(flag,'Position',[25.5, my1, 10,8.5]);
set(a1,'xdata',28,'ydata',my2);%实现旗子的移动
set(a2,'xdata',29,'ydata',my3);
set(a3,'xdata',30,'ydata',my4);
set(a4,'xdata',30,'ydata',my5);
set(a5,'xdata',29,'ydata',my6);
pause(0.001);%停顿0.001秒
drawnow;%画图
end;
